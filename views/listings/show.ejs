<% layout("/layouts/boilerplates") %>
<body>
    <div class="row mt-5">
        <div class="col-8 offset-2">
            <h2><b><%= list.title %></b> </h2>
        </div>
        
        <div class="card col-8 row-5 offset-2 mt-3 listing-card">
            <img src="<%= list.image.url %>" class="card-img-top show-img" alt="list_img"  height="10rem">
            <div class="card-body ">
                <p class="card-text ">
                    <h3 class="mt-3"></h3>
                    <p><i>Owned by : <b><%= list.owner.username %></b></i></p> 
                    <%= list.description %> <br>
                    Category : <b><%= list.category %> </b> <br>
                    Price : <b>&#8377;<%= list.price.toLocaleString("en-IN") %> </b> <br>
                    Place : <b> <%= list.location %></b>  <br>
                    Counrty : <b> <%= list.country %> </b>   <br>
                </p>
            </div>
            <div class="btns mt-3">
                <% if(currUser && currUser._id.equals(list.owner._id)){ %>
                <!-- Edit button -->
                <form action="/listings/<%= list._id %>/edit" method="GET">
                    <button class="btn btn-dark show-edit-btn">Edit</button>
                </form>

                <!-- Delete button -->
                <form action="/listings/<%= list._id %>?_method=DELETE" method="POST">
                    <button class="btn btn-danger show-delete-btn">Delete</button>
                </form> 
                <% } %>
                <% if(currUser){ %>
                <!-- Review button -->
                <form action="/listings/<%= list._id %>/reviews/new" method="GET">
                    <button class="btn  show-review-btn">Review</button>
                </form>
                <% } %>
                <br> <br>
            </div> 
        </div>
            
        <% if(list.reviews.length != 0){ %>
            <hr>
            <h4>All Review</h4>
            
            <div class="row mb-3 ms-3">
                <% for(reviews of list.reviews){ %>
                    <div class="col-md-6 mb-3">
                        <div class="card p-3">
                            <div class="card-body">
                                <h5 class="card-title"><%= reviews.author.username %></h5>
                                <p class="starability-result card-text" data-rating=<%= reviews.rating %>> </p>
                                <p class="card-text"><%= reviews.comment %></p>
                                <form action="/listings/<%= list._id %>/reviews/<%= reviews._id %>?_method=DELETE" method="POST">
                                    <button class="btn btn-primary">Delete</button>
                                </form>
                            </div>
                        </div>
                    </div>
                <% } %>
            </div>
        <% } %>
    </div>
</body>